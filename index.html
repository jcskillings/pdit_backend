<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Simple Bill Management</title>
    <link rel="stylesheet" href="css/test.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    <link rel="stylesheet" href="css/splash.css" />
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>
    <script src="js/vendor/modernizr.js"></script>

  </head>
 
  <body>
   
    <div class="row fullWidth" id="tipTopRow"></div>
    
    <div class="row fullWidth" div id="topRow">
      <div class="large-2  xlarge-2 columns">
        <a><img src="img/logoSm.png" id="mainLogo"/></a>
      </div>
      <div class="large-4 columns">
        <ul class="button-group radius even-2 " id="loginButtons">
          <li><a href="#" data-reveal-id="regModal" class="button clearRegForm">Sign up</a></li>
          <li><a href="#" data-reveal-id="loginModal" class=" button clearLoginForm" id="btnLogin">Log in</a></li>
        </ul>
      </div>
    </div>
    
    <div id="middle" >
      <div class="row">
        <div class="large-10  large-centered columns">
           <h1 data-tooltip aria-haspopup="true" class="has-tip" title="Our goal is to help remind you to pay your bills before they become overdue">
             Features of  <img src="img/paiditkyle.png" height="102" width="152"><h6 align = "right">(*verification is required for each phone/email)</h6></h1>
           <p>- Create Bills to receive notification reminders</p>
           <p>- Receieve your Bill notifications via email* and/or text*</p>
           <p>- View your Bill information on useful charts and graphs</p>
           <p>- You can attach multiple emails*/phone numbers* so you and anyone else who needs to know about a bill due date can be notified</p>
           <p>- A log is kept so you can know what has been sent/created/deleted</p>
           <p>- Calendar to easily view upcoming and late bills</p>
           <p>- Include reminders so notifications can be sent before a bill is due</p>

        </div>
      </div>
    </div>
    
    <div class="row fullWidth" id="bottomRow">
      <div class="large-12 xlarge-12 columns">
        <p>More information</p>
      </div>
    </div>
    
    <!--  registration modal-->
    <div div id="regModal" class="reveal-modal small" data-reveal aria-labelledby="Sign Up" aria-hidden="true" role="dialog">
      <div class="row">
          <div class="large-6 large-centered columns">
            <a><img src="img/logoSm.png" /></a>
          </div>
        </div>
      <form id="regForm" data-abide name='regForm' onsubmit="return validateForm()" method="post">
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Username 
              <input type="text" placeholder="username" id='regUsername' name='regUsername' required/>
            </label>
            <small class="error">username is required </small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password 
              <input type="password" placeholder="********" id='regPassword' name='regPassword' required />
            </label>
            <small class="error">password is required</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Confirm Password
              <input type="password" placeholder="*******" id='regPassConfirm' name = 'regPassConfirm' required data-equalto="regPassword"/>
            </label>
            <small class="error">passwords do not match</small>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>First Name
              <input type="text" placeholder="first name" id='regFirstName' name='regFirstName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Last Name
              <input type="text" placeholder="last name" id='regLastName' name='regLastName'/>
            </label>
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Email Address
              <input type="text" placeholder="you@example.com" id='regEmail' name = 'regEmail'/>
            </label>
          </div>
        </div>

      <div class="large-6 large-centered columns">
        <div class = "row">
        <div class="left">
          <label>Cell Phone <span data-tooltip aria-haspopup="true" class="has-tip right" title="to receive text notifications a cell phone number is required">?</span>
            <input type="text" placeholder="555-123-4567" id='regCell' name = 'regCell' style="width:120px;"/>
          </label>
        </div>
        <div class="right">
          <label>Provider</label>
          <select id="mydropdown" name="mydropdown" style="width:100px;">
            <option value="none">Select</option>
            <option value="at&t">at&t</option>
            <option value="sprint">Sprint</option>
            <option value="t-mobile">T-Mobile</option>
            <option value="verizon">Verizon</option>
            <option value="virgin">Virgin</option>
            <option value="boost">Boost</option>
            <option value="alltel">Alltel</option>
          </select>
          
        </div>
        
      </div>
      <div class="clear"></div>
    </div>
        <div class="row">
          <div class="large-3 large-centered columns">
            <label>
            <input id="checkbox1" type="checkbox" /> Remember Me
            </label>
          </div>
          
        </div>
  
        <div class="row">
          <div class="large-3 large-centered columns">
            <input href="#" type="submit" class="radius button" value="Sign up"/>
          </div>
        </div>
        <a class="close-reveal-modal" aria-label="Close">&#215;</a>
      </form>
    </div>     <!--  registration modal-->

    <!-- Login modal-->
    <div div id="loginModal" class="reveal-modal tiny" data-reveal aria-labelledby="Register" aria-hidden="true" role="dialog">
      <form id ="loginForm" data-abide name='loginForm'>
        <!-- <form id ="loginForm" data-abide name='loginForm' onsubmit="valLogin();false;" target="https://paidit-jcskillings.c9.io/home.html" > -->
       <!-- <form id ="loginForm" data-abide name='loginForm' onsubmit="return valLogin()" method="post">--> 
        <div class="row">
          <div class="large-6  large-centered columns">
            <label>Username
              <input type="text" placeholder="username" id='loginUsername' name = 'email'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <label>Password
              <input type="password" placeholder="********" id='loginPassword' name = 'password'/>
            </label>   
          </div>
        </div>
        
        <div class="row">
          <div class="large-6 large-centered columns">
            <input id="checkbox2" type="checkbox" name='remember_me'><label for="checkbox2">Remember Me</label>
          </div>
        </div>
         
        <div class="row">
          <div class="large-4 large-centered columns">
            <input href="#" class="radius button" type="button" id="loginSubmit" value="Log In"/>
          </div>
        </div>
        <a type='reset' class='close-reveal-modal clearLoginForm' aria-label='Close' id='closeLogin'>&#215;</a>
      </form>
    </div> <!-- login Modal-->
        
    <!-- jquery and foundation -->
    <script src="js/vendor/jquery.js"></script>
    <script src="/js/vendor/fastclick.js"></script>
    <script src="js/foundation.min.js"></script>

    <script>
      $(document).foundation();
  
      $.support.cors = true;
      var checked;
       //var csrftoken = getCookie('csrftoken');
      
      function redir(){
        alert('calling redir');
        //window.location.replace("https://paidt-jcskillings-c9.io/home.html");
        window.location.replace("home.html");
       // window.location="home.html";
        //self.location.href='home.html'
        //window.location.href="https://paidt-jcskillings-c9.io/home.html"
      }
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }

      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      
      var numUsers;
      var obj;
      var allUsers;
      var numLogs;
      var numMethods;
      var parse;
      var NL;
      var NM;
       
      function newCheckCookie() {
        if (getCookie("NL") == null || getCookie("NL") == "" || getCookie("NL") == '{"logs":[]}'){
          setCookie("NL",'{"logs":[]}',30);
          NL = '{"logs":[]}';
          numLogs = 0;
        }
        else {
          parse = JSON.parse(getCookie("NL"));
          numLogs = parse.logs.length; 
        }
        if (getCookie("NM") == null || getCookie("NM") == "" || getCookie("NM") == '{"methods":[]}'){
          setCookie("NM",'{"methods":[]}',30);
          NM = '{"methods":[]}';
          numMethods = 0;
        }
        else {
          parse = JSON.parse(getCookie("NM"));
          numMethods = parse.methods.length;
        }
        
        if (getCookie("allUsers") == null || getCookie("allUsers") =="" || getCookie("allUsers") == '{"users":[]}'){
          setCookie("allUsers",'{"users":[]}',30);
          allUsers = '{"users":[]}';
          numUsers = 0;
        }
        else {
          obj = JSON.parse(getCookie("allUsers"));
          numUsers = obj.users.length;
          if (getCookie("currUser") != "" && getCookie("currUser") != null){
            redir();
          }
        }
      }
      
      
      function checkCookie() {
        var numChecked = getCookie("numChecked");
        var user=getCookie("username");
        var password =getCookie("password");
        if (user == "" && password == "" && numChecked == "") {
          //do nothing but load the page
          setCookie("firstName", "", 0);
        }
        else if(user == "" && password == "" && numChecked == 0) {
          setCookie("numChecked", "", 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 0) {
          setCookie("numChecked", 1, 30);
          redir();
        }
        else if (user != "" && password != "" && numChecked == 1) {
          var firstName = getCookie("firstName");
          if (firstName != "" && firstName != null) user = firstName;
          if (confirm("  Welcome back " + user +"!\n(Not " + user + "? Press Cancel)") == true) {
            
            redir(); //also submit login info to server
          } 
          else {
            setCookie("username", "", 30);
            setCookie("password", "", 30);
            setCookie("numChecked", "", 30);
            setCookie("firstName", "", 30);
            //window.location.reload();
          }
        }
      }
      
      // User object constructor
      function User(userName, email, firstName, lastName, phone,  password){
        this.userName = userName;
        this.email = email;
        this.firstName = firstName;
        this.lastName = lastName;
        this.phone = phone;
        this.password = password;
      }
      
      function Log(info, date, time) {
        this.info = info;
        this.date = date;
        this.time = time;
      }
      
      function Method(type, destination, carrier, verified, name) {
        this.type = type;
        this.destination = destination;
        this.carrier = carrier;
        this.verified = verified;
        this.name = name;
      }
 
      
      function validateForm() {   
        var userName = document.forms["regForm"]["regUsername"].value;
        var i;
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            alert("Please choose another username, " + userName + " is taken");
            return false;
          }
        }
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          if(password.length < 6) {
            alert("Password must be at least 6 characters long");
            return false;
          }
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              var checked = document.forms['regForm']['checkbox1'].checked;
              var firstName = document.forms['regForm']['regFirstName'].value;
              var lastName = document.forms['regForm']['regLastName'].value;
              var email = document.forms['regForm']['regEmail'].value;
              var phone = document.forms['regForm']['regCell'].value;
              var newUser = new User(userName, email, firstName, lastName, phone,  password);
              
              var stringy = JSON.stringify(newUser);
              
              //$.post('https://pdit-backend-jcskillings.c9.io/user.json', stringy, function(response){
              //  alert("kyle rules");
              //},'json' );
              
              allUsers = getCookie("allUsers");
              var temp = allUsers.substring(0, allUsers.length - 2);
              if(numUsers == 0) allUsers = temp + stringy + "]}";
              else allUsers = temp + "," + stringy + "]}";
              
              //update allUsers and currUser
              setCookie("allUsers",allUsers,30);
              setCookie("currUser", stringy, 30);
              
              //update notificationLogs and notificationMethods
              var currDate = Date();
              //alert(currDate);
              var currTime = currDate.substring(16, 24);
              //alert(currTime);
              var currTZ = currDate.substring(30, 33);
              //alert(currTZ);
              currDate = currDate.substring(4, 15);
             
              var provider = document.forms['regForm']['mydropdown'].value;
              var newMethod = new Method("email", email, "none", "verified", "email1");
              var newMethod2 = new Method("cell", phone, provider, "verified", "cell1");
              //alert(newMethod);
              var stringy1 = JSON.stringify(newMethod);
              var stringy2 = JSON.stringify(newMethod2);
              NM = getCookie("NM");
              var temp1 = NM.substring(0, NM.length - 2);
              if(numMethods == 0)  NM = temp1 + stringy1 + "," + stringy2 + "]}";
              else NM = temp1 + "," + stringy1 + "," + stringy2 + "]}";
              setCookie("NM", NM, 30);
              
              var newLog = new Log("You joined Paidit!", currDate, currTime);
              stringy = JSON.stringify(newLog);
              if(email != "") {
                temp = new Log("You added an unverified Email address!(Please enter the verification code sent to that address at the homepage or in settings!)", currDate, currTime);
                stringy = stringy + "," + JSON.stringify(temp);
              }
              if(phone != "") {
                var temp2;
                if(provider == "") temp2 = new Log("You added an unverified phone#!(Please select the cellphone carrier in settings so we can send you verification code!)", currDate, currTime);
                else temp2 = new Log("You added an unverified phone#!(Please enter the verification code sent to your phone on the homepage or settings to use it)", currDate, currTime);
                stringy = stringy + "," + JSON.stringify(temp2);
              }
   
              NL = (getCookie("NL"));
              temp = NL.substring(0, NL.length - 2);
              if (numLogs == 0) {
                NL = temp + stringy + "]}";
              }
              else{
                NL = temp + "," + stringy + "]}";
              }
              setCookie("NL",NL,30);
              redir();
              
            }
          }
        }
      }
      
      
      
      function oldValidateForm() {   
      var user = document.forms["regForm"]["regUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['regForm']['regPassword'].value;
          
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          if(password.length < 6) {
            alert("Password must be at least 6 characters long");
            return false;
          }
          
          else {
            var passConfirm = document.forms['regForm']['regPassConfirm'].value;
            if (passConfirm == null || passConfirm == "") {
              alert("Password Confirmation must be filled out");
              return false;
            }
            else if(passConfirm != password){
              alert("Password does not match Password Confirmation");
              return false;
            }
            else {
              checked = document.forms['regForm']['checkbox1'].checked;
              var firstName = document.forms['regForm']['regFirstName'].value;
              if (checked == true) {
                if (firstName != "" && firstName != null) setCookie("firstName", firstName, 30);
                //send new user info to server
                setCookie("username", user, 30);
                setCookie("password", password, 30);
                setCookie("numChecked", 0, 30);
                redir();
              }
              if(checked == false){
                //send new user info to server before clearing cookies
                setCookie("username", "", 30);
                setCookie("password", "", 30);
                setCookie("numChecked", 0, 30);
                setCookie("firstName", "", 30);
                redir();
              }
            }
          }
        }
      }
      
      function validateLoginForm() {   
        var userName = document.forms["loginForm"]["loginUsername"].value;
        var i;
        var found = false;
        var id;
        
        if (userName == null || userName == "") {
          alert("Name must be filled out");
          return false;
        }
        for  (i=0; i < numUsers; i++){
          var named = obj.users[i].userName;
          if(userName == named) {
            found = true;
            id = obj.users[i].id;
            break;
          }
        }
        if(found == false) {
          alert("username not found");
          return false;
        }
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          named = obj.users[i].password;
          if(password != named) {
            alert("incorrect password");
            return false;
          }
          else {
            //obj.users[i].userStatus = "signed in";
            //obj = JSON.stringify(obj);
            //setCookie("allUsers", obj, 30);
            
            setCookie("currUser", obj.users[i], 30);
            redir();
          }
        }
      }
      $('#loginSubmit').click(function (){
        valLogin();
      });
      
      function valLogin(){
        //var userName = document.forms["loginForm"]["loginUsername"].value;
        //convert form data to json
        //alert('remem:'+document.forms["loginForm"]["remember_me"]).value;
        //var jsonLogin = ConvertFormToJSON(document.forms["loginForm"]);
        var jsonLogin = {"user":{"email":"jcskillings@gmail.com", "password":"password"}}
         //var jsonLogin = ConvertFormToJSON2(document.forms["loginForm"]);
        //alert(JSON.stringify(jsonLogin));
        //send login request to backend
         var postTry = $.post("https://pdit-backend-jcskillings.c9.io/users/sign_in", jsonLogin, function(response){
          alert("response string: " + response);
          alert("response: " + JSON.stringify(response));
        },"json"); 
        
        /* var postTry = $.ajax({
        //beforeSend : function(jqXHR) {
        //  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
        //},
          type: "POST",
          dataType: 'json',
          url: 'https://pdit-backend-jcskillings.c9.io/sign_in.json',
          data: jsonLogin,
          contentType: 'application/json',
          //contentType: 'application/json',6
          complete: function(complete){
            alert("json complete: " +complete);
          },
          success: function(data){
            alert("JSON response: " +  JSON.stringify(data));
          //obj = JSON.parse((data));
          //numBills = obj.bills.length;
          //for  (i=0; i < numBills; i++){
          //  putBill(i);
          //}
          
          },
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
        }); */
        
        alert("postTry: " + JSON.stringify(postTry));
        alert(window.location.pathname)
        if (postTry.readyState == 1) {
          //redir()
        }
      } 
      function valSignup(){
        var jsonSignup = ConvertFormToJSON(document.forms["loginForm"]);
        var postTry = $.post("https://pdit-backend-jcskillings.c9.io/users/sign_up", jsonSignup, function(response){
          alert("response: " + JSON.stringify(response));
        }, "json"); 
      }
      
      function ConvertFormToJSON(form){
          var array = jQuery(form).serializeArray();
          var json = {};
          
          jQuery.each(array, function() {
              json[this.name] = this.value || '';
              //alert('cur value: '+this.value());
          });
          
          return json;
      }
      
       function ConvertFormToJSON2(form){
          var array = jQuery(form).serializeArray();
          var json = {};
          
          jQuery.each(array, function() {
              json[this.name] = this.value || '';
              //alert('cur value: '+this.value());
          });
          
          return json;
      }
      
      function oldValidateLoginForm() {   
      var user = document.forms["loginForm"]["loginUsername"].value;
        if (user == null || user == "") {
          alert("Name must be filled out");
          return false;
        } 
        else {
          var password = document.forms['loginForm']['loginPassword'].value;
          if (password == null || password == "") {
            alert("Password must be filled out");
            return false;
          }
          else {
            checked = document.forms['loginForm']['checkbox2'].checked;
            if(checked == true) {
              setCookie("username", user, 30);
              setCookie("password", password, 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            } 
            else {
              setCookie("username", "", 30);
              setCookie("password", "", 30);
              setCookie("numChecked", 0, 30);
              //send login info to server and verify before redirecting
              redir();
            }
          }
        }
      }
      
      $(".clearLoginForm").on("click",function(){
      $("#loginForm").removeClass("error");
      $("#loginForm").removeClass("error");
      $("#loginForm")[0].reset();
      });
      
      $(".clearRegForm").on("click",function(){
      $("#regForm").removeClass("error");
      $("#regForm").removeClass("error");
      $("#regForm")[0].reset();
      });
      
    </script>
  </body>
</html>