<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Paidit | Bills</title>
    <link rel="stylesheet" href="css/billaccounts.css" />
    <link rel="stylesheet" href="css/foundation.css" />
    
    <link rel="stylesheet" href="css/test.css"/>
    
    <script type="text/javascript" src="js/bills.js"></script>
    
    <link rel="shortcut icon" href="img/icon/checkMark.png"/>

    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body >
    
    <!-- <body onload="getBillsDB()"> -->
      
      <div class="icon-bar five-up">
        <a class="item" href="home.html">
          <img src="img/icon/homeIconG.png" height="20" width="20"  >
          <label class="show-for-medium-up">Home</label>
        </a>
        <a class="item" href="analysis.html">
          <img src="img/icon/chartsIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Bill Analysis</label>
        </a>
        <a class="item" href="billaccounts.html" id="bills">
          <img src="img/icon/billIconG.png" height="20" width="20">
          <label class="show-for-medium-up" id="billstext"><b>Bills</b></label>
        </a>
        <a class="item" href="notificationslog.html">
          <img src="img/icon/smsIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Notification Log</label>
        </a>
        <a class="item" href="usersettings.html">
          <img src="img/icon/gearIconG.png" height="20" width="20">
          <label class="show-for-medium-up">Settings</label>
        </a>
      </div>
   

    <div class="container navigation" style = "width:100%; margin:2% 0% 0% 0%">

      
      <div class="small-12 small-centered large-12 large-centered columns">
        <div class="large-1 columns" align = "center">
          <a href="#" class='button radius' id='addBill' >Add Bill</a>
        </div>
          <!-- BILL LIST -->
        <table class="small-11 large-11 columns" id="billTable" name = "billTable">
          <thead  id="billTableHeader">
            <tr>
              <th width="10%">Bill</th>
              <th width="14%">Amount</th>
              <th width="14%">Due Date</th>
              <th width="14%">Due Time</th>
              <th width="13%">Notifications</th>
              <th width="20%">Repeat</th>
              <th width = "15%"></th>
            </tr>
          </thead>
          <tbody >
            <tr>
              <td><b>Example Bill</b></td>
              <td><b>$55.00 - $65.00</b></td>
              <td><b>05/19/2099</b></td>
              <!--<td ><img src="img/icon/emailIcon40px.png"/>
              <img src="img/icon/smsIcon40px.png"/>
              </td> -->
              
              <td><b>12:55 p.m.</b></td>
              
              <td><b>Email SMS</b></td>
              <td><b>Monthly</b></td>
            
              <td><button>Edit</button> <button>Delete</button></td>
              <!-- <td class="editBox"><img src="img/icon/editIcon40px.png" /></td> -->
              </tr>
              
            </tbody>
        </table>
        
        <a href="#" class="button radius" id="saveEdit">Save</a>
        <a href="#" class="button radius" id="cancelEdit">Cancel</a>        
          
        <a href="#" class="button radius" id="saveBtn">Save</a>
        <a href="#" class="button radius" id="cancelBtn">Cancel</a>
      </div> 
    </div>

    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    
    <script>
      $(document).foundation();
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }
 
      var i;
      var allBills;
      var numBills;
      var obj;
      
      // GET BILLS - Runs on pageload gets all bills stored in cookies ======
      function getBills() {
        if (getCookie("allBills") == null || getCookie("allBills") =="" || getCookie("allBills") == '{"bills":[]}'){
          setCookie("allBills",'{"bills":[]}',30);
          allBills = '{"bills":[]}';
          numBills = 0;
        }
        else {
          obj = JSON.parse(getCookie("allBills"));
          numBills = obj.bills.length;
          for  (i=0; i < numBills; i++){
            putBill(i);
          }
        }
      }
      /*$.ajaxPrefilter(function (options, originalOptions, jqXHR) {
        jqXHR.setRequestHeader('X-CSRF-Token', token);
      }); */
      $('#billTableHeader').click(function() {
         getBillsDB() ;
      });
      function getBillsDB(){
        alert('running get bills');
        //var url = "http://pdit-backend-jcskillings.c0"
        var getBillsTry = $.get("https://pdit-backend-jcskillings.c9.io/bills", function(data){
          alert(JSON.stringify(data));
        });
        /* var getBillsTry = $.ajax({
          beforeSend : function(jqXHR) {
           jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
         },
          dataType: 'json',
          type: "GET",
          url: 'https://pdit-backend-jcskillings.c9.io/bills',
         contentType: 'application/json',
         success: function(data){
          alert("JSON response: " +  JSON.stringify(data));
          //obj = JSON.parse((data));
          //numBills = obj.bills.length;
          //for  (i=0; i < numBills; i++){
          //  putBill(i);
          //}
          
          },
          error: function(error){
            alert("error:" + JSON.stringify(error));
          }
        }); */
       
        
        alert("getBillsTry: " + JSON.stringify(getBillsTry));
      }
      
      function putBill(index) {
        var table = document.getElementById("billTable");
        var row = table.insertRow(index+2);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        var cell7 = row.insertCell(6);
        var dueD = obj.bills[index].dueDate;
        var year = dueD.substr(0, 4);
        var month = dueD.substr(5, 2);
        var day = dueD.substr(8, 2);
        var date = month +"/"+day+"/"+year;
        
        var hour = dueD.substr(11,2);
        var minute= dueD.substr(14, 2);
        hour = parseInt(hour);
        //minute = parseInt(minute);
        var time;
        if (hour >0 && hour < 12) {
          time= hour+":"+minute +" a.m.";
        }
        else if(hour>12) {
          hour = hour-12;
          time= hour+":"+minute +" p.m.";
        }
        else{
          if (hour == 0) time= "12:"+minute +" a.m.";
          if (hour == 12) time= hour+":"+minute +" p.m.";
        }
        var numReminders;
        if(obj.bills[index].reminder1 == "" && obj.bills[index].reminder2 =="") numReminders=0;
        else if (obj.bills[index].reminder1 == "" || obj.bills[index].reminder2 =="")numReminders=1;
        else numReminders = 2;
        
        var category = obj.bills[index].category;
        if(category == "") category = "No notifications selected";
        cell1.innerHTML = obj.bills[index].name;
        cell2.innerHTML = "$" +obj.bills[index].amountLo+"-$"+obj.bills[index].amountHi;
        cell3.innerHTML = date;
        cell4.innerHTML = time;
        cell5.innerHTML = category;
        cell6.innerHTML = obj.bills[index].repeat + " with "+ numReminders +" reminder(s)";
        cell7.innerHTML = '<button onClick="editRow(this)" id="edit"+index>Edit</button> <button onClick="deleteRow(this)">Delete</button>';
      }
      
      function editRow(o) {
        var p=o.parentNode.parentNode;
        p.parentNode.removeChild(p);
        putInEditField();
      }
      
      var newJson;
      
      function putInEditField() {
        var j;
        var table = document.getElementById("billTable");
        var name = null;
        var category = null;
        var paymentType = null;
        var loginPage = null;
        var dueDate = null;
        var repeat = null;
        var amountLo = null;
        var amountHi = null;
        var user_name = null;
        var reminder1 = null;
        var reminder2 = null;
        newJson = null;
        var find;
        allBills = getCookie("allBills");
        var temp = JSON.parse(allBills);
        numBills = temp.bills.length;
        for(j = 2; j < numBills+1; j++){
          name = obj.bills[j-2].name;
          var row = table.rows[j].cells[0].firstChild.data;
          if (name != row) {
            name = obj.bills[j-2].name;
            category = obj.bills[j-2].category;
            paymentType = obj.bills[j-2].paymentType;
            loginPage = obj.bills[j-2].loginPage;
            dueDate = obj.bills[j-2].notifs;
            repeat = obj.bills[j-2].repeat;
            amountLo = obj.bills[j-2].amountLo;
            amountHi = obj.bills[j-2].amountHi;
            user_name = obj.bills[j-2].user_name;
            reminder1 = obj.bills[j-2].reminder1;
            reminder2 = obj.bills[j-2].reminder2;
      
            find = '{"name":"' +name;
            var tempCookie = allBills.substring(0, allBills.indexOf(find));
            var find2 = '{"name":"' +row;
            newJson = allBills.substring(allBills.indexOf(find2), allBills.length);
            newJson = tempCookie + newJson;
            break;
          }
        }
        if(newJson == null) { //editing last  & there is more than 1 bill
          name = obj.bills[(numBills-1)].name;
          category = obj.bills[(numBills-1)].category;
          paymentType = obj.bills[(numBills-1)].paymentType;
          loginPage = obj.bills[(numBills-1)].loginPage;
          dueDate = obj.bills[(numBills-1)].dueDate;
          repeat = obj.bills[(numBills-1)].repeat;
          amountLo = obj.bills[(numBills-1)].amountLo;
          amountHi = obj.bills[(numBills-1)].amountHi;
          user_name = obj.bills[(numBills-1)].user_name;
          reminder1 = obj.bills[(numBills-1)].reminder1;
          reminder2 = obj.bills[(numBills-1)].reminder2;
          if(numBills == 1) find = '{"name":"' +name;
          else find = ',{"name":"' +name;
          newJson = allBills.substring(0, allBills.indexOf(find))+"]}";
        }
        var NM = JSON.parse(getCookie("NM"));
        var numMethods = NM.methods.length;
        methods = ["", "", "", ""];
        for (var i = 0; i < numMethods; i++) {
          if(NM.methods[i].verified == "verified") {
            methods[i] = NM.methods[i].name;
          }
        }
        
        $('#addBill').css('visibility','hidden');
        //testGet2();
        $('#billTable').find('tbody').append($('<tr id="editBill">')
        .append($('<td><input type="text" placeholder="bill name" id="billname" value="'+name+'" required /></td>'))
        .append($('<td><div class="left"><div class="left"><label>$</label></div><div class="left">'+
        '<input type="text" placeholder="amount(low)" id="amountLo" value="'+amountLo+'" style="width:100px;" /></div><div class="clear"></div></div>-'+
        '<div class="right"><input type="text" placeholder="amount(high)" id="amountHi" value="'+amountHi+'"style="width:105px;" /></div><div class="clear"></td>'))
        .append($('<td><select id="month" style="width:70px;"><option value="01">Jan</option>'+
          '<option value="02">Feb</option><option value="03">Mar</option><option value="04">Apr</option>'+
          '<option value="05">May</option><option value="06">Jun</option><option value="07">Jul</option>'+
          '<option value="08">Aug</option><option value="09">Sep</option><option value="10">Oct</option>'+
          '<option value="11">Nov</option><option value="12">Dec</option></select>'+
          '<select id="day" style="width:60px;"><option value="01">01</option>'+
          '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
          '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
          '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
          '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
          '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
          '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
          '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
          '<option value="23">23</option><option value="24">24</option><option value="25">25</option>'+
          '<option value="26">26</option><option value="27">27</option><option value="28">28</option>'+
          '<option value="29">29</option><option value="30">30</option><option value="31">31</option></select>'+
          '<select id="year" style="width:75px;"><option value="2015">2015</option>'+
          '<option value="2016">2016</option><option value="2017">2017</option></select></td>'))
        .append($('<td><select id="hour" style="width:60px;"><option value="01">01</option>'+
          '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
          '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
          '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
          '<option value="11">11</option><option value="12">12</option></select>'+
          '<select id="minute" style="width:60px;"><option value="00">00</option>'+
          '<option value="05">05</option><option value="10">10</option><option value="15">15</option>'+
          '<option value="20">20</option><option value="25">25</option><option value="30">30</option>'+
          '<option value="35">35</option><option value="40">40</option><option value="45">45</option>'+
          '<option value="50">50</option><option value="55">55</option></select>'+
          '<select id="ampm" style="width:65px;"><option value="am">am</option>'+
          '<option value="pm">pm</option></select></td>'))
        .append($('<td><input id="method1" type="checkbox"/><label id="label1">'+methods[0]+'</label>'+
        '<input id="method2" type="checkbox"/><label id="label2">'+methods[1]+'</label>'+
        '<input id="method3" type="checkbox"/><label id="label3">'+methods[2]+'</label>'+
        '<input id="method4" type="checkbox"/><label id="label4">'+methods[3]+'</label></td>'))
        .append($('<td><input type="radio" id="never" name="rep" checked><label for="never">Never</label>'+
        '<input type="radio" id="weekly" name="rep"><label for="weekly">Weekly</label><input type="radio" id="monthly" name="rep"><label for="monthly">Monthly</label></td>'))
        .append($('<td></td></tr>'))
        );
        $('#billTable tr:last').after($('<tr id="extraRow"><td></td><td><b>Reminders:</b></td>'+
        '<td><div class = "left"><label>Days before + </label><select id="reminder1days" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option>'+
        '<option value="12">12</option><option value="13">13</option><option value="14">14</option></select></div>'+
        '<div class = "left"><label>Hours before due</label><select id="reminder1hours" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
        '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
        '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
        '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
        '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
        '<option value="23">23</option></select></div><div class = "clear"></div>'+
        '</td><td><div class = "left"><label>Days before + </label><select id="reminder2days" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option>'+
        '<option value="12">12</option><option value="13">13</option><option value="14">14</option></select></div>'+
        '<div class = "left"><label>Hours before due</label><select id="reminder2hours" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
        '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
        '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
        '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
        '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
        '<option value="23">23</option></select></div><div class = "clear"></div></td>'+
        '<td><label>Payment Process</label><select id="paymentType" style="width:100px;"><option value="">Select</option>'+
          '<option value="in person">In person</option><option value="online">Online</option>'+
          '<option value="by phone">By phone</option><option value="autopay">Autopay</option></select></td><td>'+
        '<input type="text" placeholder="www.wheretopaythisbill.com or 1-555-Pay-Bill" id="url" value ="'+loginPage+'" /></td></tr>'));
        var numHidden = 0;
        if(methods[3] == "") {
          $('#method4').css('visibility','hidden');
          $('#label4').css('visibility','hidden');
          numHidden++;
        }
        if(methods[2] == "") {
          $('#method3').css('visibility','hidden');
          $('#label3').css('visibility','hidden');
          numHidden++;
        }
        if(methods[1] == "") {
          $('#method2').css('visibility','hidden');
          $('#label2').css('visibility','hidden');
          numHidden++;
        }
        if(methods[0] == "") {
          $('#method1').css('visibility','hidden');
          $('#label1').css('visibility','hidden');
          numHidden++;
        }
        
        if(numHidden == 4) {
          alert("Until you have at least ONE verified email or phone notification"+
          " method, you will be unable to select notification methods for any bill."+
          " This also means that you will also be unable to receive any notifications!"+
          " They will appear area noted 'PLEASE VERIFY YOUR NOTIFICATION METHODS ASAP!' one you verify them! Thanks!");
          $('#label1').css('visibility','visible');
          document.getElementById("label1").innerHTML = "PLEASE VERIFY YOUR <br/>NOTIFICATION METHODS ASAP!".bold();
        }
        var numCommas =(category.match(/,/g) || []).length;
        alert(numCommas);
        if(repeat == "Never") document.getElementById("never").checked = true;
        else if(repeat == "Weekly") document.getElementById("weekly").checked = true;
        else document.getElementById("monthly").checked = true;
        $('#saveEdit').css('visibility','visible');
        $('#cancelEdit').css('visibility','visible');
        var myTable = document.getElementById("billTable");
        for(i = 2; i < numBills+2; i++){
          myTable.rows[i].cells[6].innerHTML = '<button onClick="youCant()">Edit</button><button onClick="youCant">Delete</button>';
        }
      }
      
      function youCant(){
        alert("You cannot edit or delete another bill while one is currently being edited");
      }
      
      function deleteRow(o){
        if (confirm("Are you sure?  Deleting this bill cannot be undone!") == true){
        var p=o.parentNode.parentNode;
        p.parentNode.removeChild(p);
        if(numBills == 1) {
          setCookie("allBills",'{"bills":[]}',30);
          return;
        }
        updateJson();
        }
      }
      
      function updateJson(){
        var j;
        var table = document.getElementById("billTable");
        obj = JSON.parse(getCookie("allBills"));
        numBills = obj.bills.length;
        var total;
        for(j = 2; j < numBills+1; j++){
          var name = obj.bills[j-2].name;
          total = '{"name":"'+name;
          var row = '{"name":"'+table.rows[j].cells[0].firstChild.data;
          if (total != row) {
            allBills = getCookie("allBills");
            var tempCookie = allBills.substring(0, allBills.indexOf(total));
            var tempCookie2 = allBills.substring(allBills.indexOf(row), allBills.length);
            tempCookie2 = tempCookie + tempCookie2;
            setCookie("allBills", tempCookie2, 30);
            window.location.replace("billaccounts.html");
          }
        }
        name = obj.bills[(numBills-1)].name;
        allBills = getCookie("allBills");
        var temp = JSON.parse(allBills);
        numBills = temp.bills.length;
        if(numBills == 0 || numBills == 1) total = '{"name":"'+name;
        else total = ',{"name":"'+name;
        tempCookie = allBills.substring(0, allBills.indexOf(total))+"]}";
        setCookie("allBills", tempCookie, 30);
        window.location.replace("billaccounts.html");
      }
      
      function testGet(){
        $.getJSON('https://pdit-backend-jcskillings.c9.io/users/22.json', function( data ){
          var items = [];
          alert(JSON.parse(data));
          $.each( data, function( key, val ) {
          items.push( "<li id='" + key + "'>" + val + "</li>" );
          });
 
          $( "<ul/>", {
            "class": "my-new-list",
            html: items.join( "" )
          }).appendTo( "body" );
          });
      }
      
      function testGet2(){
        $.getJSON('https://pdit-backend-jcskillings.c9.io/users/22', null, function(data){
          alert('did this work???');
          alert(JSON.parse(data));
        });
        
      }
        
      
      // appends individual bill to billTable
      function loadBill(bill){
        
      }
      
      // Gets a cookie by name
      function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1);
            if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
            }
          }
        return "";
      }
      
      // Bill object constructor
      function Bill(name, category, paymentType, loginPage, dueDate, repeat, amountLo, amountHi, user_name, reminder1, reminder2){
        this.name = name;
        this.category = category;
        this.paymentType = paymentType;
        this.loginPage = loginPage;
        this.dueDate = dueDate;
        this.repeat= repeat;
        this.amountLo = amountLo;
        this.amountHi = amountHi;
        this.user_name = user_name;
        this.reminder1 = reminder1;
        this.reminder2 = reminder2;
      } 
      
      
      var methods;
      $('#addBill').click(function(){
        $('#addBill').css('visibility','hidden');
        var NM = JSON.parse(getCookie("NM"));
        var numMethods = NM.methods.length;
        methods = ["", "", "", ""];
        for (var i = 0; i < numMethods; i++) {
          if(NM.methods[i].verified == "verified") {
            methods[i] = NM.methods[i].name;
          }
        }
        $('#billTable').find('tbody').append($('<tr id="createBill">')
        .append($('<td><input type="text" placeholder="bill name" id="billname" required /></td>'))
        .append($('<td><div class="left"><div class="left"><label>$</label></div><div class="left">'+
        '<input type="text" placeholder="amount(low)" id="amountLo" style="width:100px;" /></div><div class="clear"></div></div>-'+
        '<div class="right"><input type="text" placeholder="amount(high)" id="amountHi" style="width:105px;" /></div><div class="clear"></td>'))
        .append($('<td><select id="month" style="width:70px;"><option value="01">Jan</option>'+
          '<option value="02">Feb</option><option value="03">Mar</option><option value="04">Apr</option>'+
          '<option value="05">May</option><option value="06">Jun</option><option value="07">Jul</option>'+
          '<option value="08">Aug</option><option value="09">Sep</option><option value="10">Oct</option>'+
          '<option value="11">Nov</option><option value="12">Dec</option></select>'+
          '<select id="day" style="width:60px;"><option value="01">01</option>'+
          '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
          '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
          '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
          '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
          '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
          '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
          '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
          '<option value="23">23</option><option value="24">24</option><option value="25">25</option>'+
          '<option value="26">26</option><option value="27">27</option><option value="28">28</option>'+
          '<option value="29">29</option><option value="30">30</option><option value="31">31</option></select>'+
          '<select id="year" style="width:75px;"><option value="2015">2015</option>'+
          '<option value="2016">2016</option><option value="2017">2017</option></select></td>'))
        .append($('<td><select id="hour" style="width:60px;"><option value="01">01</option>'+
          '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
          '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
          '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
          '<option value="11">11</option><option value="12">12</option></select>'+
          '<select id="minute" style="width:60px;"><option value="00">00</option>'+
          '<option value="05">05</option><option value="10">10</option><option value="15">15</option>'+
          '<option value="20">20</option><option value="25">25</option><option value="30">30</option>'+
          '<option value="35">35</option><option value="40">40</option><option value="45">45</option>'+
          '<option value="50">50</option><option value="55">55</option></select>'+
          '<select id="ampm" style="width:65px;"><option value="am">am</option>'+
          '<option value="pm">pm</option></select></td>'))
        .append($('<td><input id="method1" type="checkbox"/><label id="label1">'+methods[0]+'</label>'+
        '<input id="method2" type="checkbox"/><label id="label2">'+methods[1]+'</label>'+
        '<input id="method3" type="checkbox"/><label id="label3">'+methods[2]+'</label>'+
        '<input id="method4" type="checkbox"/><label id="label4">'+methods[3]+'</label></td>'))
        .append($('<td><input type="radio" id="never" name="rep" checked><label for="never">Never</label>'+
        '<input type="radio" id="weekly" name="rep"><label for="weekly">Weekly</label><input type="radio" id="monthly" name="rep"><label for="monthly">Monthly</label></td>'))
        .append($('<td></td></tr>'))
        );
        $('#billTable tr:last').after($('<tr id="extraRow"><td></td><td><b>Reminders:</b></td>'+
        '<td><div class = "left"><label>Days before + </label><select id="reminder1days" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option>'+
        '<option value="12">12</option><option value="13">13</option><option value="14">14</option></select></div>'+
        '<div class = "left"><label>Hours before due</label><select id="reminder1hours" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
        '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
        '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
        '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
        '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
        '<option value="23">23</option></select></div><div class = "clear"></div>'+
        '</td><td><div class = "left"><label>Days before + </label><select id="reminder2days" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option>'+
        '<option value="12">12</option><option value="13">13</option><option value="14">14</option></select></div>'+
        '<div class = "left"><label>Hours before due</label><select id="reminder2hours" style="width:80px;">'+
        '<option value="00">00</option><option value="01">01</option>'+
        '<option value="02">02</option><option value="03">03</option><option value="04">04</option>'+
        '<option value="05">05</option><option value="06">06</option><option value="07">07</option>'+
        '<option value="08">08</option><option value="09">09</option><option value="10">10</option>'+
        '<option value="11">11</option><option value="12">12</option><option value="13">13</option>'+
        '<option value="14">14</option><option value="15">15</option><option value="16">16</option>'+
        '<option value="17">17</option><option value="18">18</option><option value="19">19</option>'+
        '<option value="20">20</option><option value="21">21</option><option value="22">22</option>'+
        '<option value="23">23</option></select></div><div class = "clear"></div></td>'+
        '<td><label>Payment Process</label><select id="paymentType" style="width:100px;"><option value="">Select</option>'+
          '<option value="in person">In person</option><option value="online">Online</option>'+
          '<option value="by phone">By phone</option><option value="autopay">Autopay</option></select></td><td>'+
        '<input type="text" placeholder="www.wheretopaythisbill.com or 1-555-Pay-Bill" id="url"  /></td></tr>'));
        var numHidden = 0;
        if(methods[3] == "") {
          $('#method4').css('visibility','hidden');
          $('#label4').css('visibility','hidden');
          numHidden++;
        }
        if(methods[2] == "") {
          $('#method3').css('visibility','hidden');
          $('#label3').css('visibility','hidden');
          numHidden++;
        }
        if(methods[1] == "") {
          $('#method2').css('visibility','hidden');
          $('#label2').css('visibility','hidden');
          numHidden++;
        }
        if(methods[0] == "") {
          $('#method1').css('visibility','hidden');
          $('#label1').css('visibility','hidden');
          numHidden++;
        }
        if(numHidden == 4) {
          alert("Until you have at least ONE verified email or phone notification"+
          " method, you will be unable to select notification methods for any bill."+
          " This also means that you will also be unable to receive any notifications!"+
          " They will appear area noted 'PLEASE VERIFY YOUR NOTIFICATION METHODS ASAP!' one you verify them! Thanks!");
          $('#label1').css('visibility','visible');
          document.getElementById("label1").innerHTML = "PLEASE VERIFY YOUR <br/>NOTIFICATION METHODS ASAP!".bold();
        }
        $('#saveBtn').css('visibility','visible');
        $('#cancelBtn').css('visibility','visible');
      });
      
      
      $('table').on('click', '.delete', function(){
        $(this).closest('tr').remove();
      });
      
      $('#cancelBtn').click( function() {
          $('#createBill').remove();
          $('#extraRow').remove();
          $('#saveBtn').css('visibility','hidden');
          $('#cancelBtn').css('visibility','hidden');
          $('#addBill').css('visibility','visible');
      });
      
      $('#cancelEdit').click( function() {
          $('#createBill').remove();
          $('#extraRow').remove();
          $('#saveEdit').css('visibility','hidden');
          $('#cancelEdit').css('visibility','hidden');
          $('#addBill').css('visibility','visible');
          window.location.reload();
      });
      
      $('#saveEdit').click( function() {
        $('#saveEdit').css('visibility','hidden');
        var name = document.getElementById("billname").value;
        
        var currDate = Date();
        var currTZ = currDate.substring(30, 33);
        
        var year = document.getElementById("year").value;
        var month = document.getElementById("month").value;
        var day = document.getElementById("day").value;
        
        var date = year +"-"+ month+"-"+day;
          
        var ampm = document.getElementById("ampm").value;
        var hour = document.getElementById("hour").value;
        var minute = document.getElementById("minute").value;
        
        //hour = parseInt(hour);
        //minute = parseInt(minute);
        var time;
        if(ampm == "am" && hour != "12") {
          time = hour + ":" + minute + ":00";
        }
        else if (ampm == "pm" && hour != "12") {
          hour = parseInt(hour) + 12;
          time = hour + ":" + minute + ":00";
        }
        else {
          if(ampm == "am") time = "00:" + minute + ":00";
          else time = "12:" + minute + ":00";
        }
        
        var dueDate = date + " "+ time +" +"+currTZ;
        
        var method1 = document.getElementById("method1").checked;
        var method2 = document.getElementById("method2").checked;
        var method3 = document.getElementById("method3").checked;
        var method4 = document.getElementById("method4").checked;
        
        var notifs = "";
        if (method1 == true) notifs = methods[0];
        if (method2 == true){
          if(notifs == "") notifs = methods[1];
          else notifs = notifs + ","+ methods[1];
        } 
        if (method3 == true) {
          if(notifs == "") notifs = methods[2];
          else notifs = notifs + ","+ methods[2];
        }
        if (method4 == true) {
          if(notifs == "") notifs = methods[3];
          else notifs = notifs + ","+ methods[3];
        }
        
        var category = notifs;
        alert(category);
        var loginPage = document.getElementById("url").value;
        
        var repeat;
        if(document.getElementById("never").checked == true) repeat = "Never";
        else if(document.getElementById("weekly").checked == true) repeat = "Weekly";
        else if(document.getElementById("monthly").checked == true) repeat = "Monthly";
        
        var amountLo = document.getElementById("amountLo").value;
        var amountHi = document.getElementById("amountHi").value;
        
        if(amountLo == null || amountLo == ""){
          amountLo = amountHi;
        }
        if(amountHi == null || amountHi == "") {
          amountHi = amountLo;
        }
        
        var currUser = JSON.parse(getCookie("currUser"));
        var user_name = currUser.userName;
        
        var reminder1days = document.getElementById("reminder1days").value;
        var reminder1hours = document.getElementById("reminder1hours").value;
        var reminder2days = document.getElementById("reminder2days").value;
        var reminder2hours = document.getElementById("reminder2hours").value;
        var reminder1;
        var reminder2;
        if(reminder1days == "00" && reminder1hours == "00") {
          reminder1 = "";
        }
        else reminder1 = getDateTime(year, month, day, hour, minute, reminder1days, reminder1hours);
        if(reminder2days == "00" && reminder2hours == "00") {
          reminder2 = "";
        }
        else reminder2 = getDateTime(year, month, day, hour, minute, reminder2days, reminder2hours);
        var paymentType = document.getElementById("paymentType").value;
        var newBill = new Bill(name, category, paymentType, loginPage, dueDate, repeat, amountLo, amountHi, user_name, reminder1, reminder2);
        
        var stringy = JSON.stringify(newBill);
        allBills = newJson;
        
        var tempBills = allBills.substring(0, allBills.length - 2);
        if (numBills == 1){
          allBills = tempBills + stringy + "]}";
        }
        else {
          allBills = tempBills + "," + stringy + "]}";
        }
        setCookie("allBills",allBills,30);
        $('#addBill').css('visibility','visible');
        window.location.replace("billaccounts.html");
      });
      
      $('#saveBtn').click( function() {
        $('#saveBtn').css('visibility','hidden');
        var name = document.getElementById("billname").value;
        
        var currDate = Date();
        var currTZ = currDate.substring(30, 33);
        
        var year = document.getElementById("year").value;
        var month = document.getElementById("month").value;
        var day = document.getElementById("day").value;
        
        var date = year +"-"+ month+"-"+day;
          
        var ampm = document.getElementById("ampm").value;
        var hour = document.getElementById("hour").value;
        var minute = document.getElementById("minute").value;
        
        //hour = parseInt(hour);
        //minute = parseInt(minute);
        var time;
        if(ampm == "am" && hour != "12") {
          time = hour + ":" + minute + ":00";
        }
        else if (ampm == "pm" && hour != "12") {
          hour = parseInt(hour) + 12;
          time = hour + ":" + minute + ":00";
        }
        else {
          if(ampm == "am") time = "00:" + minute + ":00";
          else time = "12:" + minute + ":00";
        }
        
        var dueDate = date + " "+ time +" +"+currTZ;
        
        var method1 = document.getElementById("method1").checked;
        var method2 = document.getElementById("method2").checked;
        var method3 = document.getElementById("method3").checked;
        var method4 = document.getElementById("method4").checked;
        
        var notifs = "";
        if (method1 == true) notifs = methods[0];
        if (method2 == true){
          if(notifs == "") notifs = methods[1];
          else notifs = notifs + ","+ methods[1];
        } 
        if (method3 == true) {
          if(notifs == "") notifs = methods[2];
          else notifs = notifs + ","+ methods[2];
        }
        if (method4 == true) {
          if(notifs == "") notifs = methods[3];
          else notifs = notifs + ","+ methods[3];
        }
        
        var category = notifs;
        alert(category);
        var loginPage = document.getElementById("url").value;
        
        var repeat;
        if(document.getElementById("never").checked == true) repeat = "Never";
        else if(document.getElementById("weekly").checked == true) repeat = "Weekly";
        else if(document.getElementById("monthly").checked == true) repeat = "Monthly";
        
        var amountLo = document.getElementById("amountLo").value;
        var amountHi = document.getElementById("amountHi").value;
        
        if(amountLo == null || amountLo == ""){
          amountLo = amountHi;
        }
        if(amountHi == null || amountHi == "") {
          amountHi = amountLo;
        }
        
        var currUser = JSON.parse(getCookie("currUser"));
        var user_name = currUser.userName;
        
        var reminder1days = document.getElementById("reminder1days").value;
        var reminder1hours = document.getElementById("reminder1hours").value;
        var reminder2days = document.getElementById("reminder2days").value;
        var reminder2hours = document.getElementById("reminder2hours").value;
        var reminder1;
        var reminder2;
        if(reminder1days == "00" && reminder1hours == "00") {
          reminder1 = "";
        }
        else reminder1 = getDateTime(year, month, day, hour, minute, reminder1days, reminder1hours);
        if(reminder2days == "00" && reminder2hours == "00") {
          reminder2 = "";
        }
        else reminder2 = getDateTime(year, month, day, hour, minute, reminder2days, reminder2hours);
        var paymentType = document.getElementById("paymentType").value;
        var newBill = new Bill(name, category, paymentType, loginPage, dueDate, repeat, amountLo, amountHi, user_name, reminder1, reminder2);
        
        var stringy = JSON.stringify(newBill);
        allBills = getCookie("allBills");
        var tempBills = allBills.substring(0, allBills.length - 2);
        if (numBills == 0){
          allBills = tempBills + stringy + "]}";
        }
        else {
          allBills = tempBills + "," + stringy + "]}";
        }
        setCookie("allBills",allBills,30);
        $('#addBill').css('visibility','visible');
        window.location.replace("billaccounts.html");
      });
      
      function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname+"="+cvalue+"; "+expires;
      }
      
      function getDateTime(year, month, day, hour, minute, reminderDays, reminderHours) {
        var finalYear;
        var finalMonth;
        var finalDay;
        var finalHour;
        var daysInPrev;
        var isLeap =new Date(year, 1, 29).getMonth() == 1;
        year = parseInt(year);
        month = parseInt(month);
        hour = parseInt(hour);
        reminderDays = parseInt(reminderDays);
        reminderHours = parseInt(reminderHours);
        
        if(month == 5 || month == 7 || month == 10 || month == 12) {
          daysInPrev = 30;
        }
        
        else if(month == 4 || month == 6 || month ==11 || month == 9 || month == 1 || month == 8 || month ==2) {
          daysInPrev = 31;
        }
        else{
          if(isLeap == true) daysInPrev = 29;
          else daysInPrev = 28;
        }
 
        if(hour - reminderHours >= 0) {
          finalHour = hour - reminderHours;
          if(finalHour <10 && finalHour >=0){
            finalHour = "0" + finalHour;
          }
        }
        else {
          finalHour = hour - reminderHours + 24;
          day = day-1;
        }
        if(day - reminderDays >= 1) {
          finalDay = day - reminderDays;
          if(finalDay <10 && finalDay >=1){
            finalDay = "0" + finalDay;
          }
        }
        else {
          month = month -1;
          finalDay = day - reminderDays + daysInPrev;
        }
        if(month > 0){
          finalMonth = month;
          finalYear = year;
          if(finalMonth <10 && finalMonth >0){
            finalMonth = "0" + finalMonth;
          }
        }
        else {
          finalMonth = 12;
          finalYear = year - 1;
        }
        
        var currDate = Date();
        var currTZ = currDate.substring(30, 33);
        
        var date = finalYear+"-"+finalMonth+"-"+finalDay;
        var time = finalHour +":"+minute+":00";
        var toReturn = date + " " + time + " +" + currTZ;
        return toReturn;
      }
      
    </script>
  </body>
</html>